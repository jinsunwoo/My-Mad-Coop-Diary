<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/styles.css?ver=74">
    <!--Jquery and Ajax-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!--Jquery cookie import-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script>
        $(document).ready(function(){
            load_user_info()
        });

        function load_user_info(){
        $.ajax({
          type: "GET",
          url: "/api/validtoken",
          headers: { 'token_give' : $.cookie('mmcdtoken') },
          data: {},
          success: function(response){
            // Log in time is not expired  
            if (response['result'] == 'success'){
                userinfo = response['userinfo']
                nickname = userinfo['nick']
                userid = userinfo['id']
                localStorage.setItem('mmcdID', userid);
                $('#usernick').text(nickname)
            // Log in time is expired
            } else{
              alert(response['msg'])
              localStorage.removeItem('mmcdID');
              window.location.href='/'
            }
          }
        })
      }

        function logapplication(){
            mmcdID = localStorage.getItem('mmcdID')
            title = $('#title').val();
            company = $('#company').val();
            potato = $('#potato').val();
            date = $('#date').val();
            id = $('#id').val();
            alert(mmcdID)
            $.ajax({
                type: "POST",
                url: "/api/logapplication",
                data: { userid_give: mmcdID, title_give:title, company_give:company, location_give:potato, date_give:date, id_give:id},
                success: function(response){
                    if (response['result'] == 'success'){
                        $('#title').val("");
                        $('#company').val("");
                        $('#potato').val("");
                        $('#date').val("");
                        $('#id').val("");
                    } else {
                        alert("Server cannot save the application")
                    }
                }
            })
        }

        // Functions for log application button with pop up
        function openForms() {
            document.getElementById("myForms").style.display = "block";
        }
        
        function closeForms() {
            $('#title').val("");
            $('#company').val("");
            $('#potato').val("");
            $('#date').val("");
            $('#id').val("");
            document.getElementById("myForms").style.display = "none";
        }

        // Remove cookie from the browser and redirect user to login page
        function logout(){
        $.removeCookie('mmcdtoken');
        localStorage.removeItem('mmcdID');
        window.location.href='/' 
      }
    </script>
</head>
<body>
    <div id="header_navbar">
        <div class="header">
            <a href="#" id="mmcd">My Mad Coop Diary</a>
                <button id="logout_btn" onclick="logout()">Log Out</button>
        </div>
            <ul class="navbar_menu">
                <li class="navbar_menu_item"><a href="{{ url_for('applied') }}">Applied</a></li>
                <li class="navbar_menu_item"><a href="{{ url_for('phone') }}">Phone screening/Assessment</a></li>
                <li class="navbar_menu_item"><a href="{{ url_for('interview') }}">Interview Offer</a></li>
                <li class="navbar_menu_item"><a href="{{ url_for('job') }}">Job offer</a></li>
                <li class="navbar_menu_item"><a href="{{ url_for('declined') }}">Declined</a></li>
                <li class="navbar_menu_item"><a href="{{ url_for('ghosted') }}">Ghosted</a></li>    
            </ul>
    </div>
    <div class="log_app_area">
        <button class="log_app_btn" onclick="openForms()">Log application</button>
    </div>
    <form class="form-popup" id="myForms">
        <div class="form-container">
          <h2>Log Application</h2>
      
          <label for="title"><b>Title</b></label>
          <input type="text" id="title" name="title" required>
      
          <label for="company"><b>Company</b></label>
          <input type="text"  id="company" name="company"  required>
      
          <label for="location"><b>Location</b></label>
          <input type="text"  id="potato" name="location" required>
      
          <label for="date"><b>Date</b></label>
          <input type="date" id="date" name="date" required>
      
          <label for="id"><b>ID</b></label>
          <input type="text" id="id" placeholder="Not required to fill" name="id">

          <button class="btn" onclick="logapplication()">Test here</button>
          <button class="btn cancel" onclick="closeForms()">Close</button>
        </div>
    </form>
    <h1 id="gl_user"><span id="usernick">Jin</span>! Search for new jobs here</h1>
    
    <form class="search" action="/report" method="get">
        <input type="text" id="input_job_desc" placeholder="Search by title, skill, or company" name="title"><br>
        <input type="text" id="input_location" placeholder="Location" name="location"><br>
        <button type="submit" class="search_btn" name="action" value="i">Indeed</button>
        <button type="submit" class="search_btn" name="action" value="s">Stackoverflow</button>
    </form>

    <h3 id="user_statistics">You have applied to 100 jobs so far. <br>
        However, 20 companies ghosted you. <br>
        You got a chance to do phone screening or assesment 80 times. <br>
        You got 50 interview offers. <br>
        20 places declined you though. <br>
        Finally, you got job offers from 50 places. 
    </h3>
</body>
</html>